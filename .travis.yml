sudo: required

language: cpp

env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "XGbNuX1/Ml77E4m5ySksEbDE8C509jl1XA5+kE/TQO3zuDWyhG04Dapz/etUqanxedQw0b8j2Rhy+ZQZROCw8TVHHWiN0kGwBmkoUSJTWNknjpv7V/yu7Zp+Y7U+2rG2OCBDceZJprx7caZIsPt4CSH82MZcGtBAIbvm19cBuitYw1ApJOcTcowVN6RmkOBAu4+ElyWeOvRrjuwZ3ugOx0zmYmrONRi619MNIdMRuZ9r9jNYllmeFPlDSXH+qb94uiqfJLPAFYVChhlnnvLvmFYT7OHEfERKeZVTiXTwkkJmP2X/GT4vKAMAqUV4fRSMBKAxSdpVYcxTC9eOi+0R6V3eJzLpv0Ca9n7o6IipyLBo6Ly7cTjseUfAkSc1i5cGzArLtsTCgskipCYTkIL2NcGWazTlugEpNhb+nL6ULz5NAZpPfzokQdZ38pWsNs5ClTe5imsFRmmQsUsGnA3X1q7q74AVJpSgzLuAbNDJNcDNl1toqkUdLWnS5zYztnXxg+LeupbB0tuGd0dGDqVHiwuSDGU4vu25ci+KooalAAozgvj8rm4DZ4hHdXBcS2DrAJEomgVroiHdLqWryl1Xg8JcKzolPNsBCoDa28sxMi94ZDOef6fcuQ6FTgEJRqOYQPmjlUz2reY3rkHzZQn40bDkC+m7k4PREA0Np5vKegk="

compiler:
  - gcc
  - clang

before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -y libprotobuf-dev protobuf-compiler  # Google Protocol Buffers
  - sudo apt-get install -y libgtest-dev                       # Google Test
  - sudo apt-get install -y libboost-all-dev                   # Boost framework

install:
# Compile Google Test static libs
  - cd /usr/src/gtest
  - sudo cmake .
  - sudo make
  - sudo cp *.a /usr/lib/
  - cd -
# Use g++4.8 and not 4.6 (C++11 missing)
  - if [ "$CXX" = "g++" ]; then export CXX="g++-4.8" CC="gcc-4.8"; fi

addons:
  coverity_scan:
    project:
      name: LeFlou/TradingSuite
    notification_email: leflou@gmx.com
    build_command_prepend: "cmake ."
    build_command: "make"
    branch_pattern: coverity_scan
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-4.8
    - g++-4.8
    - clang

before_script:
  - cmake .

script:
  - make

branches:
  only:
    - coverity_scan

notifications:
  email: true
